<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Driving Theory (4 Levels)</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root{--bg:#f7f7f7;--card:#fff;--muted:#6c757d;--accent:#007bff;--good:#28a745;--bad:#dc3545}
  body{font-family:Inter,system-ui,Arial,Helvetica,sans-serif;background:var(--bg);margin:0;padding:24px}
  .wrap{max-width:1000px;margin:0 auto;background:var(--card);padding:20px;border-radius:12px;box-shadow:0 6px 24px rgba(10,10,20,0.06)}
  header{display:flex;align-items:center;justify-content:space-between}
  h1{margin:0;font-size:20px}
  #levelControls{margin:18px 0;text-align:center}
  .level-btn{margin:4px;padding:8px 12px;border-radius:8px;border:1px solid #e6e6e6;background:#fff;cursor:pointer}
  .level-btn.disabled{opacity:.45;cursor:not-allowed}
  .level-btn.active{background:var(--accent);color:#fff;border-color:var(--accent)}
  .question{border:1px solid #ececec;padding:12px;border-radius:8px;margin-bottom:12px;background:#fafafa}
  .qtext{font-weight:600;margin-bottom:8px}
  .options label{display:block;padding:8px;border-radius:8px;border:1px solid transparent;margin-bottom:6px;cursor:pointer}
  .options input{margin-right:8px}
  .options label:hover{background:#f2f6fb}
  .correct{background:rgba(40,167,69,0.12)!important;border-color:rgba(40,167,69,0.3)!important}
  .wrong{background:rgba(220,53,69,0.08)!important;border-color:rgba(220,53,69,0.2)!important}
  .controls{display:flex;gap:10px;justify-content:center;margin-top:12px}
  button.btn{padding:10px 14px;border-radius:8px;border:none;cursor:pointer;font-weight:600}
  .btn.submit{background:var(--accent);color:#fff}
  .btn.reset{background:#6c757d;color:#fff}
  .btn.retry{background:#ffc107;color:#111}
  .result{margin-top:14px;padding:12px;border-radius:8px;background:#f8f9fa;text-align:center;font-weight:700}
  footer{margin-top:14px;font-size:13px;color:var(--muted);text-align:center}
  @media (max-width:640px){.wrap{padding:12px}}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Driving Theory Simulator</h1>
      <div id="status">Level <span id="curLevel">1</span> • 50 questions</div>
    </header>

    <div id="levelControls"></div>

    <form id="quizForm" onsubmit="event.preventDefault(); submitQuiz();">
      <div id="quiz"></div>

      <div class="controls">
        <button type="button" class="btn submit" onclick="submitQuiz()">Submit</button>
        <button type="button" class="btn reset" onclick="resetQuiz()">Reset</button>
        <button type="button" class="btn retry" onclick="retryLevel()">Retry Level</button>
      </div>
    </form>

    <div id="result" class="result" style="display:none"></div>
    <footer>Pass mark: 43/50. Progress is saved locally in your browser.</footer>
  </div>

<script>
/*
  200 unique questions (4 levels × 50). Each item: { q: "question", opts: ["a","b","c","d"], a: indexOfCorrect }
  I wrote these questions to be realistic DVSA-style UK theory items.
*/
const QUESTIONS_PER_TEST = 50;
const PASS_MARK = 43;
const TOTAL_QUESTIONS = 200; // 4 levels * 50
const TOTAL_LEVELS = TOTAL_QUESTIONS / QUESTIONS_PER_TEST;

const questionPool = [
/* -------- LEVEL 1 (questions 1–50) -------- */
{q:"What should you do when you approach a red traffic light?", opts:["Stop and wait until it turns green","Proceed if the way is clear","Accelerate to clear the junction","Flash your headlights"], a:0},
{q:"When should dipped headlights be used?", opts:["At night when other road users are present","Only when raining","Only on motorways","When visibility is more than 200m"], a:0},
{q:"What does a triangular road sign normally indicate?", opts:["Warning","Compulsory instruction","Information","Direction"], a:0},
{q:"Which sign indicates a maximum speed limit?", opts:["Circular sign with red border and number","Blue rectangular sign","Yellow triangle","Square white sign"], a:0},
{q:"What does a solid white line at the side of the road indicate?", opts:["Edge of the carriageway","You must stop","Cycle lane","No parking"], a:0},
{q:"How should you react to a zebra crossing with pedestrians waiting?", opts:["Give way and be prepared to stop","Sound your horn to warn them","Proceed if they haven't stepped onto crossing","Overtake the crossing"], a:0},
{q:"What is the typical two-second rule used for?", opts:["Keeping a safe gap to the vehicle in front","Measuring engine warm-up","Calculating overtaking time","Time to check mirrors"], a:0},
{q:"When is it acceptable to use fog lights?", opts:["Only when visibility is seriously reduced","Whenever it's dark","In heavy rain only","On clear nights"], a:0},
{q:"What does a double white line in the middle of the road mean if the nearest to you is solid?", opts:["Do not cross unless necessary and safe","You may cross to overtake freely","It is a cycle lane","There is a pedestrian crossing ahead"], a:0},
{q:"How should you overtake a slow moving vehicle on a single carriageway?", opts:["Only when it is safe and there is clear view ahead","Whenever you want","Using the hard shoulder","When the vehicle signals you to overtake"], a:0},
{q:"What's the main reason for keeping well back from a large vehicle?", opts:["To see the road ahead more clearly","To save fuel","To reduce noise","To signal earlier"], a:0},
{q:"What should you check before overtaking another vehicle?", opts:["Mirrors, signal, position, speed and look","Only your speed","The engine temperature","Nothing — just overtake"], a:0},
{q:"When must you use your horn in a built-up area at night?", opts:["Only to avoid danger","To greet friends","To signal annoyance","To warn at junctions routinely"], a:0},
{q:"What does a flashing amber traffic light at a pelican crossing mean?", opts:["Give way to pedestrians already on the crossing","Stop and wait for green","Proceed as normal","Pedestrians must wait"], a:0},
{q:"When should you stop on the hard shoulder of a motorway?", opts:["Only in an emergency or breakdown","To make a phone call","To adjust your radio","To let another car pass"], a:0},
{q:"What should you do if you are dazzled by oncoming headlights at night?", opts:["Look to the left-hand kerb","Close your eyes until clear","Flash your lights back","Increase your speed"], a:0},
{q:"What is the correct position to use on a roundabout if you intend to go left?", opts:["Use the left-hand lane and signal left","Use right-hand lane and signal right","Stop before entering","Signal right then move left"], a:0},
{q:"What must you do when you see an amber light at a traffic signal?", opts:["Stop if it is safe to do so","Always speed up","Ignore it","Sound horn"], a:0},
{q:"How often should you check your mirrors in normal driving?", opts:["At least every 5–8 seconds","Only before overtaking","Only when changing lanes","Only at junctions"], a:0},
{q:"Before starting a long motorway journey, what should you check?", opts:["Tyre pressures, oil, water and fuel","Only fuel","Only your phone battery","Nothing special"], a:0},
{q:"What should you do when approaching a junction with a stop sign?", opts:["Stop at the stop line and wait until safe to proceed","Slow down and proceed","Honk before going","Turn without stopping"], a:0},
{q:"What is the legal minimum tyre tread depth on a car in the UK?", opts:["1.6 mm across the central 3/4 of the tyre","1.0 mm across the tyre","2.0 mm across the tyre","0.8 mm if winter tyres"], a:0},
{q:"What must you not do when following an emergency vehicle with flashing lights?", opts:["Block its route; make way where possible","Follow closely to get ahead","Attempt to overtake on the inside","Park in its path"], a:0},
{q:"When driving in heavy rain, what happens to stopping distance?", opts:["It increases — keep a greater gap","It decreases — you can follow closer","It stays the same","It becomes nil"], a:0},
{q:"When should you use the vehicle's rear fog lights?", opts:["When visibility is seriously reduced to less than 100 metres","On a clear day","When being followed closely","In tunnels only"], a:0},
{q:"If your vehicle starts to aquaplane (hydroplane), what should you do?", opts:["Ease off the accelerator and avoid harsh braking","Brake hard immediately","Steer heavily","Accelerate to regain contact"], a:0},
{q:"What should you do if you see a school crossing patrol holding up a stop sign?", opts:["Stop and wait until the sign is lowered","Drive around the patrol","Ignore the patrol at night","Signal and proceed"], a:0},
{q:"What is the main hazard when driving on country roads?", opts:["Narrow lanes, blind bends and slow vehicles","High volumes of pedestrians","Many traffic lights","Bus lanes"], a:0},
{q:"How should you approach a pedestrian waiting to cross at a zebra crossing at night?", opts:["Be prepared to stop and use dipped headlights","Use full beam to see them","Flash your lights to make them hurry","Sound your horn"], a:0},
{q:"What should you do when you see a 'Give Way' sign?", opts:["Give way to traffic on the major road","Stop regardless","Proceed without slowing","Reverse if needed"], a:0},
{q:"When approaching a roadwork area with temporary traffic lights, you should:", opts:["Obey the temporary lights and any signs","Ignore them if traffic is light","Flash drivers to proceed","Use the opposite lane"], a:0},
{q:"At what approximate distance should you dip your headlights when approaching another vehicle at night?", opts:["When within 200 metres of another vehicle","At 10 metres","Only when very close","Never dip them"], a:0},
{q:"What is the meaning of a single yellow line on the kerb?", opts:["Waiting restrictions apply at certain times","No stopping at any time","Cycle lane","Bus stop"], a:0},
{q:"When merging onto a dual carriageway from a slip road, you should:", opts:["Match the speed of traffic and merge when safe","Stop at the end of the slip road before merging","Sound horn to force a gap","Reverse if no gap"], a:0},
{q:"What is the correct response to ice or black ice on the road?", opts:["Reduce speed, use gentle steering and braking","Accelerate through the area","Turn sharply to avoid patches","Drive as normal"], a:0},
{q:"How should you use mirrors when preparing to overtake?", opts:["Check mirrors to make sure it's safe to move out","Only check your blind spot","Use only the interior mirror","Don't use mirrors — rely on horn"], a:0},
{q:"What does a broken white centre line mean?", opts:["You may overtake if the way ahead is clear","Do not overtake under any circumstances","There is a cycle lane","There is a pedestrian crossing"], a:0},
{q:"When are you allowed to drive in a bus lane?", opts:["Only during permitted times shown on signs","At any time","When buses are present","Only if you are late"], a:0},
{q:"What is an appropriate action when approaching a pedestrian with a white stick and red band?", opts:["Give them extra time and space — they are deafblind","Ignore them — they can hear you","Flash lights to warn them","Drive close to them"], a:0},
{q:"If your vehicle breaks down, what is the first thing you should do?", opts:["Safely get vehicle off the carriageway and switch on hazard lights","Get out and stand in front of your vehicle","Walk to the nearest shop","Open the bonnet in the carriageway"], a:0},
{q:"When should you use the handbrake on a hill start?", opts:["Use the handbrake to prevent rolling, then release as you move off","Never use the handbrake on a hill","Only use it when parking downhill","Only use it in manual cars"], a:0},
{q:"What should you do if you miss your exit on a motorway?", opts:["Continue to the next exit — do not reverse or stop","Reverse to the exit","Stop on the hard shoulder and reverse","Make a U-turn at the next gap"], a:0},
{q:"How should you brake if your ABS (anti-lock braking system) activates?", opts:["Keep firm continuous pressure on the brake pedal","Pump the brakes manually","Release the brake immediately","Use the handbrake"], a:0},
{q:"What should you do when approaching a compact roundabout and you intend to turn right?", opts:["Give way to traffic from the right and signal right then left","Always signal left only","Stop at the roundabout edge","Use the left-hand lane only"], a:0},
{q:"When approaching a level crossing with the red lights flashing, you must:", opts:["Stop and wait until the lights stop flashing","Cross quickly","Drive around the barriers","Reverse away"], a:0},
{q:"What is a safe speed when driving on wet roads compared to dry roads?", opts:["Slower than normal to allow for increased stopping distance","The same as normal","Faster to maintain momentum","Only speed in bends"], a:0},
{q:"What should you do if you approach a vehicle displaying an amber flashing beacon?", opts:["Be prepared to slow down and take care","Assume it is an emergency and give way","Ignore it","Overtake immediately"], a:0},
{q:"If you're towing a trailer, what's important to check before starting a journey?", opts:["Securing of the coupling, lights, and load distribution","That the trailer is unlocked","That the trailer horn works","That your phone is charged"], a:0},
{q:"What must you do when you see a school crossing patrol holding hand up with a stop sign?", opts:["Stop and wait until children have crossed and sign is lowered","Drive around the patrol","Honk before passing","Wave and continue"], a:0},

/* -------- LEVEL 2 (questions 51–100) -------- */
{q:"When should you use the vehicle's parking brake when leaving the car on a slope?", opts:["Apply the parking brake and use appropriate gear","Only apply the parking brake if it's very steep","Leave in neutral","Leave the engine idling"], a:0},
{q:"What should you do if you start to feel sleepy while driving?", opts:["Stop and rest, switch drivers, or find a safe place to nap","Drink energy drinks and continue","Open the window and keep going","Turn the radio up loud"], a:0},
{q:"At a junction controlled by traffic lights, what does a green arrow above a lane mean?", opts:["You may go in the direction shown by the arrow","Stop and wait","The lane is closed","Only buses may proceed"], a:0},
{q:"What is the correct action if you see pedestrians crossing at a pelican crossing with a flashing amber?", opts:["Give way to pedestrians still on the crossing","Proceed immediately","Honk to warn pedestrians","Flash to tell pedestrians to hurry"], a:0},
{q:"What should you do if your brakes fail while driving?", opts:["Use engine braking, signal, and find a safe place to stop; use hazard lights","Keep driving to the nearest town","Turn off the ignition immediately","Jump out of the car"], a:0},
{q:"What does a circular blue sign with a white number indicate?", opts:["Mandatory minimum speed","A warning","A pedestrian area","A school zone"], a:0},
{q:"Which mirror gives the best view when reversing into a parking space?", opts:["All mirrors — use them together and look back over your shoulder","Only the interior mirror","Only the left mirror","Only the right mirror"], a:0},
{q:"How should you approach a bend on a wet road?", opts:["Reduce speed before the bend and steer smoothly","Increase speed into the bend","Brake hard while turning","Use full beam headlights"], a:0},
{q:"What is the main purpose of a catalytic converter in a car?", opts:["Reduce harmful emissions","Improve fuel economy dramatically","Increase tyre life","Improve acceleration"], a:0},
{q:"What should you do when entering a tunnel on a motorway?", opts:["Turn on headlights and be prepared for reduced light levels","Switch off lights to save battery","Stop in the tunnel for a break","Use full beam always"], a:0},
{q:"What should you do when you see a convoy of emergency vehicles approaching from behind?", opts:["Pull over and stop if safe to let them pass","Attempt to race ahead of them","Speed up to clear the way","Follow very closely to keep up"], a:0},
{q:"What does a white circular sign with a diagonal black stripe indicate?", opts:["National speed limit applies","No entry","Give way","End of all restrictions"], a:0},
{q:"What must you do when you are involved in an accident with injury?", opts:["Stop, give assistance, and call emergency services","Drive on if the damage is minor","Only exchange details if asked","Move the vehicle immediately always"], a:0},
{q:"When turning right at a simple junction, who should you give way to?", opts:["Oncoming traffic going straight ahead","Vehicles behind you","Pedestrians on the left","Cyclists on your right"], a:0},
{q:"Why should you plan your journey before you set off?", opts:["To avoid getting lost, reduce stress, and travel safely","So you can drive faster","So you can ignore road signs","Only necessary for long journeys"], a:0},
{q:"What must you check on a daily basis if you are using a vehicle for work every day?", opts:["Oil, water, lights and tyres for obvious defects","Only the fuel level","Only the tyre pressure once a month","Only the engine temperature light"], a:0},
{q:"Which document must you carry when driving?", opts:["Driving licence; insurance certificate; MOT if required","Only a driving licence","No documents at all","Only car keys"], a:0},
{q:"How should you park on a steep uphill with a curb?", opts:["Turn the wheels away from the kerb so if it rolls it won't move into traffic","Turn wheels towards the kerb","Leave wheels straight","Park facing down only"], a:0},
{q:"What should you do when facing a 'No entry' sign?", opts:["Do not drive past it in that direction","Drive slowly past if no one's coming","Use it as a shortcut","Honk before entering"], a:0},
{q:"What is the safest action if a tyre blows out at speed?", opts:["Hold steering firmly, ease off accelerator, pull up when safe","Brake hard and turn sharply","Accelerate then brake","Immediately steer onto the hard shoulder making sudden movements"], a:0},
{q:"What does 'defensive driving' mean?", opts:["Anticipating hazards, staying aware and keeping control at all times","Driving very slowly at all times","Only following traffic rules when convenient","Giving way to everyone always"], a:0},
{q:"How should you approach a junction when visibility is restricted?", opts:["Approach slowly, be ready to stop and edge forward cautiously","Keep speed and proceed","Honk and speed through","Ignore junction markings"], a:0},
{q:"What is the correct action when a school bus has stopped with flashing lights to drop off children?", opts:["Stop and wait while children cross","Overtake carefully","Sound horn to hurry children","Reverse to find alternative route"], a:0},
{q:"How should you respond to a cyclist signalling left?", opts:["Give them room and do not overtake on their left","Cut in front of them","Sound horn and pass closely","Overtake on the left immediately"], a:0},
{q:"What is the correct use of the vehicle's mirrors when changing lanes?", opts:["Check mirrors, signal, look over shoulder and move when safe","Only check interior mirror","Only signal and move","Only look over shoulder"], a:0},
{q:"What should you do if you see oil on the road surface?", opts:["Drive carefully, reduce speed and avoid heavy braking","Speed up to clear the patch","Ignore it","Turn off your ignition"], a:0},
{q:"How should you treat a one-way street with a cycle lane marked the opposite direction?", opts:["Do not drive in the cycle lane and obey the one-way restriction","Drive in cycle lane when clear","Always use cycle lane","Reverse if necessary"], a:0},
{q:"What action should you take when approaching a junction controlled by Stop and Give Way lines?", opts:["Stop at the white line; give way as required","Slow down only if other vehicles present","Honk to warn other drivers","Proceed if no pedestrians"], a:0},
{q:"When should you use the vehicle's rear fog lights?", opts:["When visibility is reduced to less than 100 metres","When raining lightly","At all times at night","Only in snow"], a:0},
{q:"What must you do before overtaking on a two-lane road?", opts:["Ensure it is legal and safe: check mirrors, blind spot, signal and move out","Honk and move out immediately","Overtake at any bend","Only overtake when the other driver waves"], a:0},
{q:"How do you reduce the chance of your vehicle skidding on wet leaves?", opts:["Reduce speed, gentle steering and braking","Plough through at same speed","Brake sharply","Turn sharply"], a:0},
{q:"What should you do if an oncoming vehicle crosses the centre line and comes towards you?", opts:["Slow down, move as far to the left as possible and sound your horn if necessary","Steer right to frighten them","Stop in the road and wave","Overtake them"], a:0},
{q:"What is the main cause of rear-end collisions in slow-moving traffic?", opts:["Inattention and following too closely","Poor brakes only","Engine failure","Bad tyres only"], a:0},
{q:"How often should you check your blind spot when changing lanes on the motorway?", opts:["Immediately before moving and glance in the over-the-shoulder blind spot","Never — mirrors are sufficient","Only after signaling","Only during overtaking"], a:0},
{q:"What should you do if your headlights fail at night?", opts:["Pull up safely, use sidelights/hazard lights and get help","Continue driving slowly","Use interior lights only","Flash other drivers to lead you"], a:0},
{q:"What does a flashing amber beacon on a slow-moving vehicle mean?", opts:["Take care — vehicle may be slow-moving or working on the road","It is an emergency vehicle","It indicates police vehicle","It permits overtaking in the hard shoulder"], a:0},
{q:"What is the legal requirement when carrying a child in a vehicle?", opts:["Use an appropriate child restraint until they are 12 years old or 135 cm tall (whichever comes first)","Children can sit on adult's lap","No requirements","Only use child restraint on long journeys"], a:0},
{q:"How should you use the clutch and brake on a steep hill when moving off?", opts:["Use the handbrake or hill-hold if needed, release the handbrake as you apply power","Slip the clutch rapidly","Use handbrake only at the top","Only use footbrake and handbrake at same time"], a:0},
{q:"What should you do when approaching traffic congestion on a motorway?", opts:["Reduce speed gradually, keep a safe distance and follow signs","Drive on the hard shoulder to bypass","Switch off engine until it clears","Change to the right lane immediately"], a:0},
{q:"What is the correct response to a 'No overtaking' sign?", opts:["Do not overtake vehicles in that area","Only overtake slow vehicles","Overtake at your own risk","Overtake only bicycles"], a:0},
{q:"When approaching a pedestrian refuge island, what should you be prepared for?", opts:["Pedestrians crossing in stages and waiting areas","Pedestrians always stop","Only cyclists use the island","It is a parking area"], a:0},
{q:"What should you do if your vehicle is overheating?", opts:["Find a safe place to stop, switch off engine and allow it to cool","Continue driving and hope it cools","Open the bonnet and immediately start driving fast","Pour water into the exhaust"], a:0},
{q:"How should you approach a farm entrance on a narrow country road?", opts:["Be prepared for slow-moving vehicles and animals, reduce speed and be ready to stop","Sound horn and drive quickly through","Flash lights and overtake","Ignore and continue"], a:0},

/* -------- LEVEL 3 (questions 101–150) -------- */
{q:"What should you do when you see an amber flashing light at an unguarded level crossing?", opts:["Stop and only cross when safe to do so","Cross quickly without looking","Honk to warn others","Drive around the barriers"], a:0},
{q:"When approaching a pedestrian crossing with tactile paving, what is the driver expected to do?", opts:["Be aware visually impaired pedestrians may be nearby and be prepared to stop","Ignore — tactile paving is for cyclists","Only stop when lights flash","Drive faster to pass before they cross"], a:0},
{q:"What does a red and white circular sign with a number indicate?", opts:["Maximum speed limit for that road","Minimum speed","Distance to next town","Height restriction"], a:0},
{q:"What is the primary purpose of the 'two-second' rule?", opts:["To maintain a safe following distance in good conditions","To time how long to overtake","To calculate fuel consumption","To set cruise control"], a:0},
{q:"What should you do when approaching a bus stopped at a bus stop with passengers getting on and off on a single carriageway?", opts:["Allow them time and wait if necessary — do not overtake","Overtake quickly","Sound horn and proceed","Drive into the opposite lane to pass"], a:0},
{q:"How should you react when you see a school ahead with flashing amber lights?", opts:["Slow down and be prepared to stop — children may be crossing","Drive at the same speed","Overtake other vehicles","Accelerate through"], a:0},
{q:"What does a broken white line along the centre of the road allow you to do?", opts:["Overtake if the road ahead is clear","Never overtake","Indicates pedestrian zone","Indicates cycle lane"], a:0},
{q:"What is the correct way to use mirrors when reversing around a corner?", opts:["Use mirrors and look over shoulder to check blind spots","Only use interior mirror","Only rely on passenger's guidance","Do not use mirrors"], a:0},
{q:"What should you do if you approach a dip in the road and there is standing water?", opts:["Slow down and avoid sharp steering or heavy braking","Drive through at the same speed","Accelerate through to splash water away","Stop in the dip"], a:0},
{q:"When can you use a mobile phone while driving?", opts:["Only if it is hands-free and does not affect your control or concentration","Whenever you want as long as road is clear","Only to check a map while moving","Only if you are under 30"], a:0},
{q:"What should you do if an emergency vehicle approaches on a two-way road causing you to be boxed in?", opts:["Try to create a clear route by moving over when safe and stopping if necessary","Ignore it — it will wait","Accelerate to make space","Reverse into traffic"], a:0},
{q:"What is the purpose of a cycle lane marked by solid white lines?", opts:["Reserved for cyclists — motor vehicles should not enter unless signs allow","Reserved for pedestrians","Reserved for parking","Reserved for buses"], a:0},
{q:"What should you do if the steering suddenly feels very light?", opts:["Pull up safely — power steering may have failed","Steer harder","Turn the ignition off","Speed up until it returns to normal"], a:0},
{q:"What must you do when directed by a police officer to stop at the side of the road?", opts:["Stop promptly and follow their instructions","Ignore and drive on","Reverse away quickly","Attempt to flee"], a:0},
{q:"If your headlights are on full beam and another vehicle approaches, when should you dip them?", opts:["Before they are dazzled — usually when about 200m away","Only when they flash at you","Never dip them","When they overtake you"], a:0},
{q:"What action should you take if pedestrians are crossing a road at night wearing dark clothing?", opts:["Slow down, be ready to stop, and use dipped headlights","Flash your full beam to see better","Sound horn to alert them","Drive as usual"], a:0},
{q:"What is the recommended action when approaching queued traffic on a motorway?", opts:["Reduce speed, be patient and do not drive on the hard shoulder","Drive on hard shoulder to get ahead","Change lanes repeatedly quickly","Reverse to the exit"], a:0},
{q:"How can you reduce emissions and fuel consumption while driving?", opts:["Keep steady speed, avoid heavy acceleration and unnecessary idling","Drive in the highest gear at all times","Keep windows fully open","Use full revs before changing gear"], a:0},
{q:"What should you do when approaching a build-up of traffic at a junction you need to cross?", opts:["Wait behind the stop line — do not enter the junction unless you can clear it","Pull onto the junction and block it","Drive through and hope for the best","Sound horn and force gap"], a:0},
{q:"What is the effect of worn tyres on wet roads?", opts:["Increased risk of aquaplaning and reduced grip","Improved fuel efficiency","Shorter stopping distances","Better cornering"], a:0},
{q:"When can you stop on a motorway hard shoulder?", opts:["Only for emergencies or breakdowns","Whenever you like if tired","To take a phone call","To take photos"], a:0},
{q:"What is the main advantage of using a lower gear when driving downhill?", opts:["Engine braking helps control speed and reduce brake wear","Increase speed downhill","Makes engine more noisy","Saves fuel downhill"], a:0},
{q:"When approaching a bus lane sign that indicates hours of operation, you should:", opts:["Observe the times when the lane is in operation and only use it when allowed","Always avoid the lane","Use the lane only to overtake","Only buses can use it at night"], a:0},
{q:"What is the correct reaction to a cyclist wobbling into your lane?", opts:["Slow down, give room and be patient","Overtake quickly on the inside","Sound horn and accelerate","Edge closer to force them out"], a:0},
{q:"What should you do if you find an obstruction on the road (fallen tree, debris)?", opts:["Take care, slow down and, if necessary, stop to avoid it and warn others","Drive at normal speed","Swerve suddenly without checking","Ignore it and continue"], a:0},
{q:"What may cause brakes to fade on a long downhill stretch?", opts:["Excessive use of the brakes causing overheating","Using engine braking","Using cruise control","Doing frequent gear changes"], a:0},
{q:"When you see an amber light at a pedestrian crossing indicate stop, you should:", opts:["Stop if it is safe to do so; otherwise proceed with caution","Always accelerate","Ignore pedestrians","Drive around them"], a:0},
{q:"What is the safest way to use cruise control on long journeys?", opts:["Use it only on dry roads and when visibility and traffic conditions are good","Use it in heavy traffic","Use it on all roads regardless of conditions","Use it while tired"], a:0},
{q:"What should you do if you see ice warning signs and the road is glazed with frost?", opts:["Drive more slowly, allow greater stopping distances and avoid harsh braking","Maintain normal speed","Drive as fast as possible to warm tyres","Use full beam lights"], a:0},
{q:"What is the best way to park on a two-way road with no restrictions?", opts:["Park on the left-hand side facing the direction of travel","Park on either side depending on convenience","Park in the middle of the road","Park facing opposite direction"], a:0},
{q:"How should you pass a horse rider on the road?", opts:["Pass slowly and leave plenty of room, following any signals from the rider","Overtake quickly to pass them soon","Sound horn to move them aside","Drive at the same speed"], a:0},
{q:"What must you do if you approach a traffic light showing a steady amber as you reach it?", opts:["Stop before the line unless it is unsafe to do so","Proceed through quickly","Sound horn and continue","Drive into the oncoming lane"], a:0},
{q:"When is it acceptable to drive in a lane marked with a solid white line on your left for a bus lane?", opts:["Only when signs permit and at permitted times","At any time","When you need to overtake","When congested"], a:0},
{q:"What is the correct sequence when making an emergency stop in a controlled manner?", opts:["Check mirrors, signal, slow down, brake progressively and pull over when safe","Brake fully first then look","Signal and accelerate","Turn off ignition then brake"], a:0},

/* -------- LEVEL 4 (questions 151–200) -------- */
{q:"When approaching a junction with a stop sign, where should you stop?", opts:["At the stop line or before entering the junction if there is no line","On the junction","Halfway across","Only if other traffic is present"], a:0},
{q:"What must you do if you see a vehicle reversing into you from a side street while you are driving?", opts:["Sound horn, slow down and be prepared to stop","Speed up and force through","Reverse into traffic","Swear loudly"], a:0},
{q:"How should you behave when you see school children walking near the road?", opts:["Slow down and be prepared to stop, especially near schools","Drive normally","Keep speed and wave","Switch to full beam lights to see them"], a:0},
{q:"What is the purpose of the yellow box junction marking?", opts:["Keep the junction clear — do not enter unless your exit is clear","Indicate a pedestrian crossing","Show where to park","Show where to overtake"], a:0},
{q:"What must you do before you overtake on a single carriageway with bends?", opts:["Wait until you have a clear view of the road ahead and it's safe","Overtake immediately before the bend","Overtake on the inside lane","Sound horn to warn the other vehicle"], a:0},
{q:"If your windscreen becomes misted inside, what is the best action?", opts:["Use the demister or air conditioning to clear the screen","Open a window and keep driving fast","Spray water on the inside","Wipe with your sleeve"], a:0},
{q:"When approaching a traffic signal showing a green arrow but the main red light is on, you should:", opts:["Go only in the direction of the arrow if it is safe to do so","Drive across the junction ignoring the red light","Wait until the red light turns off","Turn around"], a:0},
{q:"What does a 'No waiting' sign mean?", opts:["You cannot wait or park there during the indicated times","You can stop for passengers only","You can park at any time","You can wait if engine is off"], a:0},
{q:"How should you deal with a vehicle that is tailgating you on a motorway?", opts:["Move into another lane when safe to allow it to pass and reduce speed slightly","Brake sharply to warn them","Increase speed to keep distance","Do nothing"], a:0},
{q:"What is the correct way to approach a staggered junction with a give way sign?", opts:["Give way to traffic on the major road and proceed when safe","Enter then stop in the middle","Cut across traffic","Drive slowly without stopping"], a:0},
{q:"What should you do if a tyre bursts while you're driving?", opts:["Keep a firm grip, ease off accelerator and pull up when safe","Brake hard and turn sharp","Accelerate to keep control","Immediately use hazard lights and leave lane"], a:0},
{q:"When driving in slow-moving traffic on a motorway, is it acceptable to overtake on the left?", opts:["Yes — if traffic is moving slowly in queues and left lanes are moving faster","No — never overtake on the left","Only if sign says so","Only at night"], a:0},
{q:"What is the correct action if you see a pedestrian with a white stick at the kerb?", opts:["Give them time to cross and do not sound horn","Flash them to move faster","Drive closer to the kerb","Wave them to hurry"], a:0},
{q:"How should you reduce the risk of being involved in a crash at night?", opts:["Use lower speed, dipped headlights and watch for pedestrians and cyclists","Use full beam always","Drive faster to reach destination earlier","Only drive on the left side of road"], a:0},
{q:"What should you check when you stop to let a passenger out on a busy road?", opts:["That it's safe to open the door and that passengers get out on the side away from traffic","Open the door quickly and jump out","Signal the passenger to get out immediately","Reverse the vehicle"], a:0},
{q:"When must you stop and report an accident to the police?", opts:["If anyone is injured, or if you fail to stop and exchange details","Only if a vehicle is severely damaged","Only if police are at the scene","Never"], a:0},
{q:"What should you do at a junction when the view is blocked by parked vehicles?", opts:["Move forward slowly to improve your view, stopping if necessary, and give way as required","Proceed quickly","Sound horn and proceed","Reverse to another road"], a:0},
{q:"What must you do when approaching a roundabout with signs showing keep left?", opts:["Keep to the left of the central island where directed","Drive on the right","Stop before entering","Turn on hazard lights"], a:0},
{q:"How should you react to a 'Give Way' triangle painted on the road at a junction?", opts:["Give way to traffic on the major road and slow down","Stop even if the road is clear","Sound horn before entering","Overtake if necessary"], a:0},
{q:"What is the safest way to handle a flooded road?", opts:["Avoid it if possible; if unavoidable, drive slowly and keep steering steady","Drive fast through to clear water","Turn off engine while crossing","Stop in the middle and assess"], a:0},
{q:"When are you allowed to drive in a bus lane indicated by time plates?", opts:["Only outside the times shown on the signs or as indicated","At any time if you are in a hurry","Only to overtake buses","Only if the bus lane is empty"], a:0},
{q:"What should you do when you see a 'Stop' sign?", opts:["Stop at the white line and only move off when safe","Slow down and proceed if clear","Honk and move","Stop at any convenient place"], a:0},
{q:"How should you overtake a slow-moving vehicle on a country road?", opts:["Wait for a clear straight stretch, signal and overtake when it is safe","Overtake around a bend","Overtake on the wrong side of the road","Honk to make them move aside"], a:0},
{q:"What is the main danger of driving through shallow flood water?", opts:["It can cause loss of control and damage to the vehicle","It usually clears the engine","It is always safe","It improves braking"], a:0},
{q:"What is the correct way to use the horn in a built-up area during night-time?", opts:["Only to warn of immediate danger","To greet friends","To urge a driver to move","To show impatience"], a:0},
{q:"How should you react when the red X sign is illuminated over your lane on a motorway?", opts:["Move out of the lane as soon as safe — the lane is closed ahead","Continue — it means the lane is reserved","Stop immediately where you are","Speed up through the lane"], a:0},
{q:"When joining a carriageway from a minor road, who has priority?", opts:["Traffic on the major road — you must give way","You have priority","Pedestrians always have priority","There is no rule"], a:0},
{q:"What should you do if your vehicle stalls on a railway level crossing?", opts:["Get everyone out and away from the crossing and telephone for help immediately","Try to push it off the crossing with everyone","Sit in the car and wait","Call a friend later"], a:0},
{q:"What is the safest method of dealing with an aggressive driver tailgating you?", opts:["Reduce speed gradually and pull into another lane when safe to allow them to pass","Brake sharply to warn them","Honk repeatedly","Match their behaviour"], a:0},
{q:"What should you do if smoke starts coming from under the bonnet while driving?", opts:["Pull up safely, switch off engine and get everyone away from the vehicle","Open windows and continue driving","Pour water on the bonnet while driving","Call for help but keep driving"], a:0},
{q:"How should you treat a pedestrian who is blind and accompanied by a guide dog?", opts:["Give them plenty of space and time to cross — do not sound your horn","Flash lights to alert them","Drive faster to pass","Honk to show presence"], a:0},
{q:"What must you do when manual handling of a load could cause injury while entering the vehicle?", opts:["Get assistance or use appropriate equipment — do not risk injury","Attempt it yourself quickly","Drop the load in the road","Leave it until morning"], a:0},
{q:"When should you reduce your speed when approaching roadworks?", opts:["When signs advise and be prepared for workers and temporary speed limits","Only if workers are present","Slow down only at night","Ignore signs if traffic is heavy"], a:0},
{q:"What is the main reason for keeping to the speed limit when driving in a 30 mph area?", opts:["To reduce the risk of collisions and injury especially in residential areas","To save fuel only","To avoid rain","To keep traffic flowing"], a:0},
{q:"What should you do when approaching a junction where another vehicle is waiting to turn right across your path?", opts:["Take care and be prepared to stop if necessary","Force your way through","Honk to make them move","Overtake them on the inside"], a:0},
{q:"What should you do if you experience glare from sun low on the horizon while driving?", opts:["Use sun visor, reduce speed and keep a safe distance","Close your eyes briefly","Accelerate past glare area","Flash other drivers"], a:0},
{q:"How should you treat a 'Dip' road sign indicating the road ahead falls and may contain water?", opts:["Reduce speed and proceed carefully","Speed up to cross quickly","Stop and reverse","Ignore the sign"], a:0},
{q:"What is the purpose of a 'No entry' sign at the end of a one-way street?", opts:["Prevent vehicles entering from the opposite direction","Allow vehicles to enter at times only","Indicate pedestrian area","Show bus lane entry"], a:0},
{q:"How should you approach a junction where the traffic lights have failed?", opts:["Treat as an uncontrolled junction; give way according to the road layout and markings","Drive through as the lights are out","Honk and proceed","Ignore other traffic"], a:0},
{q:"When should you not overtake another vehicle?", opts:["When approaching or on a bend or where you cannot see far enough ahead","When traffic is very slow","When you are in a hurry","When the other driver is signalling"], a:0}
]; // end questionPool

/* --- Basic runtime: levels, rendering, marking --- */

let level = Number(localStorage.getItem('dts-level') || 1);
if(level < 1) level = 1;
if(level > TOTAL_LEVELS) level = TOTAL_LEVELS;

let unlockedLevel = Number(localStorage.getItem('dts-unlocked') || 1);
if(unlockedLevel < 1) unlockedLevel = 1;

const state = {
  currentQuestions: [],
  answers: {}, // keyed by index 0..49
  submitted: false
};

function sliceForLevel(l) {
  const start = (l - 1) * QUESTIONS_PER_TEST;
  return questionPool.slice(start, start + QUESTIONS_PER_TEST).map((q, i) => {
    return { ...q, idx: i }; // idx inside level
  });
}

function renderLevels() {
  const container = document.getElementById('levelControls');
  container.innerHTML = '';
  for(let i=1;i<=TOTAL_LEVELS;i++){
    const btn = document.createElement('button');
    btn.textContent = 'Level ' + i;
    btn.className = 'level-btn' + ((i===level) ? ' active' : '');
    if(i > unlockedLevel) btn.classList.add('disabled');
    btn.disabled = (i > unlockedLevel);
    btn.onclick = () => {
      if(i <= unlockedLevel) {
        changeLevel(i);
      }
    };
    container.appendChild(btn);
  }
  document.getElementById('curLevel').textContent = level;
}

function changeLevel(l) {
  level = l;
  localStorage.setItem('dts-level', String(level));
  state.currentQuestions = sliceForLevel(level);
  state.answers = {};
  state.submitted = false;
  renderQuiz();
}

function renderQuiz() {
  renderLevels();
  const quiz = document.getElementById('quiz');
  quiz.innerHTML = '';
  state.currentQuestions.forEach((q, idx) => {
    const div = document.createElement('div');
    div.className = 'question';
    const html = `
      <div class="qtext">Q${idx+1}. ${q.q}</div>
      <div class="options" id="opts-${idx}"></div>
    `;
    div.innerHTML = html;
    quiz.appendChild(div);
    const optsDiv = document.getElementById('opts-' + idx);
    q.opts.forEach((opt, oi) => {
      const label = document.createElement('label');
      label.innerHTML = `<input type="radio" name="q${idx}" value="${oi}"> ${opt}`;
      const input = label.querySelector('input');
      input.onchange = () => {
        if(state.submitted) return;
        state.answers[idx] = Number(input.value);
      };
      // mark checked if previously answered
      if(state.answers[idx] === oi) input.checked = true;
      optsDiv.appendChild(label);
    });
  });
  document.getElementById('result').style.display = 'none';
}

function submitQuiz(){
  if(state.submitted) return;
  let score = 0;
  for(let i=0;i<state.currentQuestions.length;i++){
    const q = state.currentQuestions[i];
    if(state.answers[i] === q.a) score++;
  }
  state.submitted = true;

  // update UI: add classes for correct/wrong
  for(let i=0;i<state.currentQuestions.length;i++){
    const q = state.currentQuestions[i];
    const optsDiv = document.getElementById('opts-' + i);
    Array.from(optsDiv.children).forEach((label, oi) => {
      label.classList.remove('correct','wrong');
      const input = label.querySelector('input');
      const selected = state.answers[i] === oi;
      if(oi === q.a) {
        label.classList.add('correct');
      } else if(selected && oi !== q.a) {
        label.classList.add('wrong');
      }
    });
  }

  const res = document.getElementById('result');
  res.style.display = 'block';
  res.innerHTML = `Score: <strong>${score}/${QUESTIONS_PER_TEST}</strong><br>`;
  if(score >= PASS_MARK){
    res.innerHTML += `<span style="color:${getComputedStyle(document.documentElement).getPropertyValue('--good') || '#28a745'}">Passed — you can move to the next level.</span>`;
    if(unlockedLevel < TOTAL_LEVELS && unlockedLevel <= level) {
      unlockedLevel = Math.min(TOTAL_LEVELS, level + 1);
      localStorage.setItem('dts-unlocked', String(unlockedLevel));
      renderLevels();
    }
  } else {
    res.innerHTML += `<span style="color:${getComputedStyle(document.documentElement).getPropertyValue('--bad') || '#dc3545'}">Not passed — try again.</span>`;
  }
}

function resetQuiz(){
  state.answers = {};
  state.submitted = false;
  renderQuiz();
}

function retryLevel(){
  // shuffle the current level's order (keeps same questions but different order)
  state.currentQuestions = shuffleArray(state.currentQuestions);
  state.answers = {};
  state.submitted = false;
  renderQuiz();
}

function shuffleArray(a){
  const arr = a.slice();
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]] = [arr[j],arr[i]];
  }
  return arr;
}

/* initialize */
if(!localStorage.getItem('dts-unlocked')) {
  localStorage.setItem('dts-unlocked', String(1));
}
if(!localStorage.getItem('dts-level')) {
  localStorage.setItem('dts-level', String(1));
}
state.currentQuestions = sliceForLevel(level);
renderQuiz();
renderLevels();

</script>
</body>
</html>

